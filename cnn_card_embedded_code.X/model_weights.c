#include "tensor.h"

/* 99th percentile of activations per layer
 * copied from cnn/train.ipynb
 */

const float conv0_activation_99per = 2.552926778793335;
const float conv1_activation_99per = 3.3553481101989746;
const float conv2_activation_99per = 2.686431033611297;

/* weight tensor data (definitions below)
 * (copied from cnn/train.ipynb)
 */

const float conv0_kernel_data[] = {
    1.1559218e+00, -8.5636085e-01, 8.533966e-01, 8.6538935e-01, -1.4901878e-01,
    -7.88024e-01, 9.361498e-02, 5.7001144e-01, -2.7457973e-01, 8.568686e-01,
    1.1742764e+00, 7.073245e-01, -2.7676934e-01, 7.8824735e-01, -6.848863e-01,
    1.1143159e+00,
};

const float conv0_bias_data[] = {
    4.2818406e-01, 9.3949e-04, -2.590457e-01, -1.3410304e-01,
};

const float conv1_kernel_data[] = {
    -1.3517789e-02, -1.5910402e-01, 2.420524e-01, 1.5155286e-01, 1.2683372e-01,
    -5.794525e-02, -1.7156291e-01, -2.9660347e-01, 1.6433902e-01, 7.677872e-02,
    -2.0371746e-01, 7.0949334e-01, -2.9975796e-01, -2.5062463e-01, 2.538191e-01,
    -8.859465e-02, 3.333215e-01, -1.7319205e-01, -4.0424988e-01, -6.134679e-01,
    2.9669023e-01, 3.5042474e-01, 1.9025762e-02, -1.14119895e-01, 3.7619415e-01,
    1.6296479e-01, 2.8240633e-01, 5.777964e-02, 2.6562357e-01, 7.743399e-02,
    1.8203796e-01, -3.4224835e-01, 4.5506483e-01, 2.4045014e-01, 1.6329497e-01,
    5.3678805e-01, -3.4729626e-02, 2.9291156e-01, -2.268529e-02, -2.6870048e-01,
    4.8911273e-02, -5.023242e-01, 1.366918e-02, 4.461571e-01, -1.2375494e-01,
    -1.8987668e-01, 4.3789402e-01, -1.1486291e-01, 7.7265345e-02, 1.577549e-01,
    -2.2537174e-02, -2.7425283e-01, -1.631519e-01, 3.0027777e-02, 5.3495723e-01,
    4.4257176e-01, 3.2833403e-01, 3.0552122e-01, 2.3599522e-01, 3.573163e-02,
    2.811687e-01, -3.2799783e-01, -2.7010605e-01, 4.0752086e-01, -9.3622655e-02,
    1.9485144e-01, -4.849648e-01, 2.163054e-01, -1.3127954e-01, 4.3296388e-01,
    -5.519067e-02, -4.166651e-02, -2.5263137e-01, 1.0694999e-01, 3.263389e-01,
    7.273637e-02, -6.545907e-02, 1.6400062e-01, 2.992805e-01, -3.292634e-01,
    -1.753439e-01, -3.7397507e-01, -2.1266863e-01, -2.9691496e-01, -7.5311124e-02,
    9.679156e-02, 1.9085176e-01, -4.3317932e-01, -4.7202414e-01, -1.9923185e-01,
    4.568007e-02, -1.0239117e-01, 5.6850326e-01, 4.3474126e-01, -2.0775367e-02,
    -3.7082934e-01, -1.00495e-01, 1.23291135e-01, -4.5906637e-02, 3.9708782e-02,
    -3.6555788e-01, -9.37929e-02, 1.0361253e-01, 9.330753e-02, -1.5320821e-01,
    -4.1016352e-01, 6.07512e-02, -2.1350497e-01, -1.4476243e-01, 6.3331733e-03,
    6.968561e-01, -1.2927236e-01, -5.994246e-01, 1.1273051e-01, 1.3686e-01,
    -1.3553244e-01, -1.2192358e-02, 6.959083e-02, -1.4201461e-01, 3.873757e-01,
    1.3336574e-01, 2.8831863e-01, 1.7552742e-01, 3.878989e-02, 6.659993e-01,
    -5.122764e-01, 1.0840053e-02, 3.219343e-01,
};

const float conv1_bias_data[] = {
    -2.2103223e-01, 6.7901134e-02, -1.8982995e-01, 1.805683e-01, -5.95986e-02,
    8.721045e-02, -1.7713824e-01, 1.0532126e-01,
};

const float conv2_kernel_data[] = {
    -1.06104836e-01, -9.832353e-02, 1.6820557e-01, 9.516621e-02, -3.9558746e-02,
    -9.866927e-03, 1.8191949e-01, 6.6408366e-02, 1.4645945e-01, 5.256398e-02,
    -9.9021204e-02, 1.9601526e-02, 1.1648055e-01, -2.1814851e-01, 7.849829e-02,
    -1.9963339e-01, 6.368055e-02, -3.4119926e-02, -5.5351622e-02, 5.0908897e-02,
    9.393946e-03, 2.9600412e-01, 1.6455656e-01, 4.417244e-02, -3.04324e-01,
    4.469861e-02, 1.399418e-01, 4.8798162e-02, 6.8127096e-02, 2.8281054e-04,
    5.876635e-02, -1.5174241e-01, 9.163624e-02, -1.1914948e-01, 2.0529467e-01,
    1.0523501e-01, 6.754796e-02, 5.1141173e-02, 1.509895e-01, -1.1939679e-01,
    -5.5805724e-02, 3.7518537e-01, 2.8037552e-02, -5.2960135e-02, -2.8862914e-01,
    9.23924e-02, 5.425287e-02, 1.7205505e-01, -2.736981e-01, 2.3340395e-01,
    -3.9161628e-01, 1.2277747e-01, -3.3990484e-02, -2.221618e-01, 7.72218e-02,
    -1.6536166e-01, -3.339759e-01, 2.7092823e-01, -8.139641e-02, -1.7082676e-01,
    -2.2534671e-01, -1.15525745e-01, 6.461236e-02, 1.8718494e-01, 4.392323e-01,
    9.471952e-02, 3.0030984e-01, 1.4467094e-02, 3.5124162e-01, -2.5717633e-02,
    -5.2966367e-02, 2.885098e-01, 1.3684295e-01, 1.0188052e-01, 1.21431634e-01,
    -1.5268656e-02, 1.4715305e-01, -5.3366598e-02, -2.7438528e-03, -1.2566815e-02,
    -1.4109975e-01, 6.13964e-02, -8.8006675e-02, 1.2171088e-01, -1.1581815e-01,
    7.56836e-02, 8.8062964e-02, 1.3520762e-01, 4.7071684e-02, 1.619953e-01,
    6.933561e-02, -2.3099206e-01, 1.1830564e-01, -2.6312232e-01, -8.7483555e-02,
    3.5500523e-02, 2.3444071e-01, -1.5434363e-01, -1.3293904e-01, 1.364919e-01,
    -1.2912157e-01, 6.274154e-02, -1.09435424e-01, 1.938134e-02, 9.8435335e-02,
    8.0296226e-02, -6.947708e-02, 6.892851e-02, -1.9867e-03, -2.7275056e-02,
    3.6781225e-02, -2.2162063e-01, 8.908029e-02, -2.1139774e-02, -2.388115e-02,
    -1.7293906e-01, 1.6455099e-01, -9.397043e-03, -1.4203013e-01, 2.9222435e-01,
    1.5770233e-01, -2.5052667e-01, 1.2517098e-01, -6.1570156e-02, -6.0686734e-02,
    -2.9440423e-02, -2.431426e-01, -1.3409524e-02, 1.04691036e-01, 1.1161508e-01,
    2.3286903e-01, 1.11509904e-01, 1.9399194e-01, 7.445656e-02, 7.814871e-02,
    5.8102045e-02, 3.123511e-01, 1.6625345e-01, -4.978766e-02, 1.0553915e-01,
    2.0062731e-01, -8.460863e-02, 1.049397e-01, -5.918447e-02, 1.02872476e-01,
    1.2950468e-02, 7.7093425e-03, 2.5454413e-02, -2.3099625e-01, 2.5566617e-01,
    1.3201262e-01, 1.9030716e-02, -1.0296073e-01, 2.1697438e-01, 1.3684836e-01,
    -3.50717e-02, -3.193667e-02, 2.1875806e-01, 3.8501315e-02, 2.554903e-01,
    -7.165109e-02, 9.0283155e-02, 8.0532566e-02, -4.774048e-02, 8.748697e-02,
    -1.3324806e-01, -1.3899976e-01, 5.35202e-02, 8.494493e-02, 1.4484185e-01,
    2.3233768e-02, -1.05944574e-01, -2.9137893e-02, 1.05205715e-01, -6.760338e-02,
    -7.3243774e-02, 1.1569727e-02, -2.2146861e-01, -3.45245e-01, 3.506681e-02,
    1.5260547e-02, -1.3666227e-01, -1.8360738e-01, -2.6842102e-02, -2.0990528e-01,
    1.2891094e-01, 2.6501777e-02, 1.8786925e-01, 1.1099192e-01, -2.2772487e-01,
    -1.4985825e-01, -1.6758868e-01, 3.4333095e-03, -2.312152e-02, 1.0379837e-01,
    1.0586787e-01, -1.690586e-01, -1.992999e-01, 5.568477e-02, 1.8018074e-01,
    1.3344008e-02, 1.682404e-01, -1.9333749e-01, -7.9761654e-02, 2.2652306e-01,
    8.705575e-02, 1.12887226e-01, 2.2137028e-01, -4.9044896e-02, -6.1161384e-02,
    -6.0437955e-02, -7.772924e-02, 1.7059276e-01, -5.8468424e-02, 6.820035e-02,
    -7.335657e-02, 5.926088e-02, 7.209625e-02, -1.2108104e-01, -9.927502e-03,
    -3.171654e-02, -1.2626107e-01, -1.9690701e-01, 2.0192425e-01, 1.4575233e-01,
    -9.3611695e-02, -1.0222937e-02, 2.2531824e-02, 4.4211034e-02, -5.2800804e-02,
    -2.3666294e-02, 2.2016728e-01, -7.63998e-02, -1.8981373e-01, 1.0969226e-01,
    -1.5786989e-01, 2.068656e-02, -5.5405922e-02, 1.3934876e-01, -3.1228465e-01,
    -1.9026698e-01, -2.875872e-02, 2.8037716e-02, 8.68215e-02, 1.8368083e-01,
    -2.8398722e-02, 3.9490756e-02, 1.2396962e-01, 9.969473e-02, -3.556222e-01,
    -7.7654414e-02, -1.5283164e-01, -3.088381e-01, -2.2860585e-01, -6.8235435e-02,
    -1.0161889e-01, -1.6640784e-01, 5.7616305e-02, -9.2804015e-02, 9.641198e-02,
    -3.5401374e-01, -9.876815e-02, 7.307518e-02, 1.0243571e-01, 2.240149e-01,
    -3.7590835e-02, 8.17313e-02, -2.3008822e-02, -1.2331312e-02, 4.8046075e-02,
    1.0251906e-01, -9.246943e-02, -2.687324e-01, -1.0411766e-01, -2.4523877e-01,
    -1.680675e-01, -1.1455555e-02, 7.635505e-02, -1.14132054e-01, 7.938767e-03,
    1.3439138e-01, -3.826391e-02, 1.8616652e-01, -4.155547e-03, 2.3363397e-01,
    -1.3978182e-02, -8.949934e-03, 8.126995e-02, -1.9306636e-01, -2.0324571e-01,
    5.423114e-02, -8.2473636e-02, 1.6652639e-01, 4.5823526e-02, 1.4253236e-01,
    -1.0679715e-01, 8.8025235e-02, -3.2118376e-02, 1.02228686e-01, 9.663504e-02,
    -4.442652e-02, -8.008581e-02, 6.8503916e-03, 5.7659034e-02, -3.4613374e-01,
    -4.5645498e-02, 6.623737e-02, 6.1786037e-02, 4.8577484e-02, -3.041029e-02,
    -4.576334e-02, 9.066875e-03, 4.5496833e-02, -1.1586618e-01, -8.511876e-02,
    3.094805e-02, -1.1154145e-01, -2.4324894e-01, 1.1021206e-01, -2.0311189e-01,
    2.7001566e-01, 1.0050373e-01, 6.1761387e-02, 2.0249975e-01, -7.6463534e-03,
    5.6457547e-03, 1.09697625e-01, 2.001874e-01, 3.300563e-01, 4.992825e-02,
    1.4061911e-01, -3.194925e-02, 8.126649e-02, 8.2335696e-02, -3.3933872e-03,
    1.0402449e-01, -1.3749164e-01, 2.1949356e-02, -6.5746106e-02, -1.2326184e-01,
    -2.082034e-02, -1.4765988e-02, 1.7154068e-01, 2.2388992e-01, -2.061056e-01,
    7.4999295e-02, 5.003878e-02, -2.2387291e-01, -9.5648654e-02, 1.6507317e-01,
    -3.147808e-02, -3.7586037e-02, 7.745296e-02, 5.8151037e-02, 9.6362986e-02,
    -1.9154103e-02, -2.9545365e-02, -1.9040795e-01, 1.13694325e-01, 3.958504e-01,
    -1.0300683e-01, -3.429925e-01, 1.627533e-01, 1.5639845e-02, -1.3434236e-01,
    1.5610251e-01, -3.3519033e-02, 1.2596402e-01, 7.252753e-02, 9.866082e-02,
    -3.9027188e-02, 3.1294012e-01, -2.816788e-01, -2.0167934e-02, 8.9236975e-02,
    1.1454631e-01, -1.3685644e-01, 5.5575415e-02, 1.3630594e-01, -4.2327944e-02,
    2.9559027e-02, 3.840007e-02, -2.0547093e-01, -1.5875144e-01, -5.640945e-02,
    -1.1037341e-01, -1.079981e-01, 1.12478975e-02, -2.5561368e-01, -6.326759e-02,
    1.9474944e-02, 5.2733435e-03, 4.4594362e-01, -3.9036363e-02, -2.746527e-01,
    8.163688e-02, -2.1068983e-01, -1.7839526e-01, 2.289355e-01, 4.8944745e-02,
    -8.541406e-02, 1.7708571e-01, -2.5676534e-01, -1.3917908e-01, 1.3172656e-01,
    5.883808e-02, -4.335536e-02, -1.8756902e-01, 2.07885e-02, -3.1199966e-02,
    1.6697336e-02, 2.7320625e-02, 7.084054e-02, 3.506055e-02, 3.800729e-02,
    -1.3570925e-02, 1.0914063e-01, 7.3202e-02, 2.6207846e-01, -7.0825364e-03,
    2.0226777e-01, -3.9293975e-02, 9.343952e-02, -5.7053667e-02, 2.274753e-01,
    -4.6511278e-02, -7.752725e-02, -1.3623405e-01, -1.038168e-01, -4.5198847e-02,
    -7.6109186e-02, 1.1792825e-01, -1.8449381e-01, -1.9502972e-01, 1.5085751e-01,
    -2.8260672e-01, -9.8007195e-02, -1.0016198e-01, 6.1439496e-02, -5.0547924e-02,
    5.5209056e-02, -4.7910556e-02, 5.553176e-02, 1.7830943e-01, -1.8270478e-02,
    -2.060605e-01, -4.7075275e-02, 1.4156161e-01, 1.7156368e-01, -1.5773084e-02,
    1.2157246e-01, -1.5406902e-01, 1.1161378e-01, 2.1880287e-01, 2.4541216e-01,
    1.167681e-01, 9.305446e-02, 2.9585254e-01, -1.753814e-01, 6.503857e-02,
    1.049155e-01, 7.271503e-02, 1.04988e-01, 6.894165e-02, -2.4477984e-01,
    -1.6756858e-01, 3.10346e-02, -1.3773905e-01, -1.7604306e-01, -2.7745727e-02,
    2.4176164e-01, -1.20331995e-01, 4.9153987e-02, 1.6726212e-01, -3.0515563e-01,
    1.3236834e-01, 5.3476816e-04, -3.9990548e-02, -1.8142392e-01, -1.1582396e-01,
    4.9634196e-02, 1.03684194e-01, 1.5470204e-01, -9.303098e-02, -2.5664908e-01,
    -1.9809823e-02, 3.858897e-01, -1.2103802e-02, -2.8303126e-01, -1.2192167e-02,
    -8.4690616e-02, -1.6103098e-01, -5.8795806e-02, 5.9411105e-02, 9.8405935e-02,
    -1.4532772e-01, 4.3460317e-02, -1.0003379e-01, -2.1623021e-02, 1.6553514e-01,
    -8.940749e-02, 1.8187562e-01, 2.4348481e-01, -6.445382e-02, 2.6282195e-02,
    1.0722949e-01, 2.1120995e-01, -1.7044018e-01, -1.2293415e-01, -1.474503e-02,
    -8.6769454e-02, -1.8484281e-01,
};

const float conv2_bias_data[] = {
    -1.9656377e-01, -1.7262107e-01, 2.7107801e-02, -1.779257e-01, -1.21556416e-01,
    -8.788595e-02, -3.668387e-02, 6.806987e-02, -4.822215e-02, -4.8354045e-02,
    -9.457664e-02, 1.0371014e-01, 1.239373e-02, 3.137853e-02, -1.3043095e-01,
    -1.0616413e-01,
};

const float dense_kernel_data[] = {
    2.6271707e-01, 6.660977e+00, -4.811248e-01, 4.5339835e-01, -2.0175812e+00,
    -1.1641924e+00, -6.1763245e-01, 1.1679087e+00, -1.6719947e+00, -1.3774924e+00,
    -4.7905335e+00, 5.213741e+00, 2.535287e+00, -1.4888505e+00, -1.0347704e+00,
    2.4320996e+00, 1.9114472e+00, 5.289298e-01, -1.9851195e+00, -2.4976857e+00,
    -2.291013e-01, 3.9296718e+00, 9.515251e-01, -4.4508383e-01, -2.334533e+00,
    1.3984635e-01, 5.010656e+00, 4.545018e+00, -1.989916e+00, -3.228789e+00,
    2.5833888e+00, -6.008552e-01, -2.8757697e-01, -7.377731e-01, 7.8606516e-01,
    1.4687439e+00, -2.9835284e+00, -2.1609943e+00, 3.5959115e+00, -8.0120695e-01,
    -1.1015593e+00, -4.7214428e-01, -1.675667e+00, -6.3184065e-01, -3.3786094e-01,
    3.167996e+00, 5.2220404e-01, -1.0654266e+00, -1.7374591e+00, -2.8833467e-01,
    2.8343666e-01, -1.3366673e+00, 2.550805e+00, -4.2440333e+00, 2.9162386e-01,
    -1.6482347e+00, -6.2099326e-01, 2.323469e+00, -4.590042e-01, -5.5490274e+00,
    -6.355115e-01, -1.0878011e-01, -6.420755e-01, 2.5141928e+00, -8.255223e-01,
    5.255149e-03, -2.0658953e+00, -1.3176367e+00, -4.742275e-01, -2.8169332e+00,
    2.1810877e-01, 4.0708834e-01, 2.7985816e+00, -2.2957683e+00, 2.2638822e+00,
    1.1761509e+00, 3.970181e-02, 5.260782e+00, 3.5948842e+00, -1.0562773e+00,
    -1.6710316e+00, -4.559941e+00, 1.6134225e+00, 1.7626171e+00, 4.73844e+00,
    1.8937773e+00, -1.1851788e+00, 2.2976606e+00, 8.053864e-02, -1.9613287e+00,
    -2.1973467e+00, -7.050898e-01, -7.511513e-01, -8.569222e-01, -1.1927048e-01,
    -2.3357177e+00, 3.1378567e+00, -3.7762082e+00, -2.4860942e+00, 2.0733843e+00,
    -1.441029e+00, 3.0617037e+00, 1.1994965e-01, 1.6854845e+00, 1.1929646e+00,
    -8.8197076e-01, -2.4115696e+00, -4.5549893e+00, -1.8532e+00, -2.125037e+00,
    -1.7542639e+00, -1.8610538e+00, 7.7772676e-04, -4.8921294e+00, 1.7593408e+00,
    5.2836366e+00, -3.983415e-01, 6.6027576e-01, -1.0966177e+00, -1.6598235e+00,
    -1.0783119e+00, 2.1020386e+00, 2.2804573e+00, 3.7378845e+00, -3.0494514e-01,
    7.572277e-01, 1.0882636e+00, -2.4873633e+00, 2.145027e+00, -2.012708e+00,
    7.095317e-02, -3.277376e+00, -1.1887145e+00, -6.7293894e-01, -1.7821856e+00,
    -2.9292968e-01, -9.152984e-01, 7.038882e-01, -2.908917e+00, -3.6177921e+00,
    2.014352e+00, 1.5558649e+00, -1.2660244e+00, 1.3142847e+00, -2.103317e+00,
    1.8749137e+00, 2.0505202e+00, -3.3148072e+00, -1.9737097e+00, -3.5077553e-02,
    -9.52308e-01, -1.2177922e+00, 2.555695e+00, -8.2561314e-02, 2.054108e+00,
    -3.4857216e+00, 1.7263368e+00, -4.6217246e+00, -1.0837222e+00, 2.5458062e+00,
};

const float dense_bias_data[] = {
    8.2213354e-01, 1.9860941e+00, -2.008242e+00, 4.249102e-03, 2.0752156e-01,
    4.5832568e-01, -1.1843564e-01, -4.6870276e-01, 3.09463e-02, -8.9547396e-01,
};


/* Weight tensor definitions */

const struct float_4tensor conv0_kernel = {
    .data=(float*) conv0_kernel_data,
    .s0=2, // rows
    .s1=2, // cols
    .s2=1, // input channels
    .s3=4  // filters
};


const struct float_4tensor conv0_bias = {
    .data=(float*) conv0_bias_data,
    .s0=4, // channels
    .s1=1,
    .s2=1,
    .s3=1 
};

const struct float_4tensor conv1_kernel = {
    .data=(float*) conv1_kernel_data,
    .s0=2, // rows
    .s1=2, // cols
    .s2=4, // input channels
    .s3=8  // filters
};

const struct float_4tensor conv1_bias = {
    .data=(float*) conv1_bias_data,
    .s0=8, // channels
    .s1=1,
    .s2=1,
    .s3=1 
};

const struct float_4tensor conv2_kernel = {
    .data=(float*) conv2_kernel_data,
    .s0=2, // rows
    .s1=2, // cols
    .s2=8, // input channels
    .s3=16  // filters
};

const struct float_4tensor conv2_bias = {
    .data=(float*) conv2_bias_data,
    .s0=16, // channels
    .s1=1,
    .s2=1,
    .s3=1 
};

const struct float_4tensor dense_kernel = {
    .data=(float*) dense_kernel_data,
    .s0=10, // input channels
    .s1=16, // units
    .s2=1,
    .s3=1
};

const struct float_4tensor dense_bias = {
    .data=(float*) dense_bias_data,
    .s0=10, // channels
    .s1=1,
    .s2=1,
    .s3=1 
};